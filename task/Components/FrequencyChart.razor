@using task.Models

@if (Result != null)
{
    <MudCard Class="mt-4">
        <MudCardHeader>
            <CardHeaderContent>
                <MudText Typo="Typo.h6">Результаты анализа</MudText>
            </CardHeaderContent>
        </MudCardHeader>
        <MudCardContent>
            <!-- Статистика -->
            <MudPaper Elevation="0" Class="pa-3 mb-4" Style="background-color: var(--mud-palette-background-grey);">
                <MudGrid>
                    <MudItem xs="6" sm="4" md="2">
                        <MudText Typo="Typo.caption" Color="Color.Secondary">Файл:</MudText>
                        <MudText Typo="Typo.body2"><strong>@Result.FileName</strong></MudText>
                    </MudItem>
                    <MudItem xs="6" sm="4" md="2">
                        <MudText Typo="Typo.caption" Color="Color.Secondary">Размер:</MudText>
                        <MudText Typo="Typo.body2"><strong>@FormatFileSize(Result.FileSize)</strong></MudText>
                    </MudItem>
                    <MudItem xs="6" sm="4" md="2">
                        <MudText Typo="Typo.caption" Color="Color.Secondary">Всего символов:</MudText>
                        <MudText Typo="Typo.body2"><strong>@Result.TotalChars.ToString("N0")</strong></MudText>
                    </MudItem>
                    <MudItem xs="6" sm="4" md="2">
                        <MudText Typo="Typo.caption" Color="Color.Secondary">Уникальных:</MudText>
                        <MudText Typo="Typo.body2"><strong>@Result.UniqueChars</strong></MudText>
                    </MudItem>
                    <MudItem xs="12" sm="8" md="4">
                        <MudText Typo="Typo.caption" Color="Color.Secondary">Время обработки:</MudText>
                        <MudText Typo="Typo.body2"><strong>@FormatProcessingTime(Result.ProcessingTime)</strong></MudText>
                    </MudItem>
                </MudGrid>
            </MudPaper>

            <!-- Фильтры и настройки -->
            <MudPaper Elevation="1" Class="pa-3 mb-4">
                <MudGrid>
                    <MudItem xs="12" md="4">
                        <MudText Typo="Typo.body2" Class="mb-2">Показать:</MudText>
                        <MudButtonGroup Color="Color.Primary" Variant="Variant.Outlined" Size="Size.Small">
                            <MudButton OnClick="() => ChangeFilter(FilterMode.All)"
                                       Variant="@(currentFilter == FilterMode.All ? Variant.Filled : Variant.Outlined)">
                                Все
                            </MudButton>
                            <MudButton OnClick="() => ChangeFilter(FilterMode.Letters)"
                                       Variant="@(currentFilter == FilterMode.Letters ? Variant.Filled : Variant.Outlined)">
                                Буквы
                            </MudButton>
                            <MudButton OnClick="() => ChangeFilter(FilterMode.Digits)"
                                       Variant="@(currentFilter == FilterMode.Digits ? Variant.Filled : Variant.Outlined)">
                                Цифры
                            </MudButton>
                            <MudButton OnClick="() => ChangeFilter(FilterMode.Punctuation)"
                                       Variant="@(currentFilter == FilterMode.Punctuation ? Variant.Filled : Variant.Outlined)">
                                Знаки
                            </MudButton>
                            <MudButton OnClick="() => ChangeFilter(FilterMode.Whitespace)"
                                       Variant="@(currentFilter == FilterMode.Whitespace ? Variant.Filled : Variant.Outlined)">
                                Пробелы
                            </MudButton>
                        </MudButtonGroup>
                    </MudItem>

                    <MudItem xs="12" md="4">
                        <MudText Typo="Typo.body2" Class="mb-2">Сортировка:</MudText>
                        <MudButtonGroup Color="Color.Primary" Variant="Variant.Outlined" Size="Size.Small">
                            <MudButton OnClick="() => ChangeSortMode(SortMode.Frequency)"
                                       Variant="@(currentSort == SortMode.Frequency ? Variant.Filled : Variant.Outlined)">
                                По частоте
                            </MudButton>
                            <MudButton OnClick="() => ChangeSortMode(SortMode.Alphabet)"
                                       Variant="@(currentSort == SortMode.Alphabet ? Variant.Filled : Variant.Outlined)">
                                По алфавиту
                            </MudButton>
                        </MudButtonGroup>
                    </MudItem>

                    <MudItem xs="12" md="4">
                        <MudText Typo="Typo.body2" Class="mb-2">Количество:</MudText>
                        <MudButtonGroup Color="Color.Primary" Variant="Variant.Outlined" Size="Size.Small">
                            <MudButton OnClick="() => ChangeTopCount(20)"
                                       Variant="@(topCount == 20 ? Variant.Filled : Variant.Outlined)">
                                20
                            </MudButton>
                            <MudButton OnClick="() => ChangeTopCount(50)"
                                       Variant="@(topCount == 50 ? Variant.Filled : Variant.Outlined)">
                                50
                            </MudButton>
                            <MudButton OnClick="() => ChangeTopCount(100)"
                                       Variant="@(topCount == 100 ? Variant.Filled : Variant.Outlined)">
                                100
                            </MudButton>
                            <MudButton OnClick="() => ChangeTopCount(int.MaxValue)"
                                       Variant="@(topCount == int.MaxValue ? Variant.Filled : Variant.Outlined)">
                                Все
                            </MudButton>
                        </MudButtonGroup>
                    </MudItem>
                </MudGrid>
            </MudPaper>

            <!-- Диаграмма -->
            <MudPaper Elevation="1" Class="pa-3" Style="min-height: 600px;">
                <canvas id="frequencyChart" style="max-height: 600px;"></canvas>
            </MudPaper>
        </MudCardContent>
    </MudCard>
}